#컴포저블

## 1. 컴포저블이란
- vue 컴포지션 api를 활용하여 상태 저장 로직을 캡슐화 & 재사용 함수
- 일반적인 공통화 함수는 상태 비저장 로직 캡슐화
- 컴포저블은 여기에 상태를 저장하여 시간이 지남에 따라 변경되는 상태를 관리

## 2. 마우스 위치 추적기 예제
- as-is
```js
<script setup>
import { ref, onMounted, onUnmounted } from 'vue'

const x = ref(0)
const y = ref(0)

function update(event) {
  x.value = event.pageX
  y.value = event.pageY
}

onMounted(() => window.addEventListener('mousemove', update))
onUnmounted(() => window.removeEventListener('mousemove', update))
</script>

<template>마우스 위치: {{ x }}, {{ y }}</template>
```
- to-be
```js
// mouse.js
import { ref, onMounted, onUnmounted } from 'vue'

// 관례상, 컴포저블 함수 이름은 "use"로 시작합니다.
export function useMouse() {
  // 컴포저블로 캡슐화된 내부에서 관리되는 상태
  const x = ref(0)
  const y = ref(0)

  // 컴포저블은 시간이 지남에 따라 관리되는 상태를 업데이트할 수 있습니다.
  function update(event) {
    x.value = event.pageX
    y.value = event.pageY
  }

  // 컴포저블은 또한 이것을 사용하는 컴포넌트의 생명주기에 연결되어
  // 사이드 이펙트를 설정 및 해제할 수 있습니다.
  onMounted(() => window.addEventListener('mousemove', update))
  onUnmounted(() => window.removeEventListener('mousemove', update))

  // 관리 상태를 반환 값으로 노출
  return { x, y }
}

// 사용처
<script setup>
import { useMouse } from './mouse.js'

const { x, y } = useMouse()
</script>

<template>마우스 위치: {{ x }}, {{ y }}</template>
```

- 로직을 외부 함수로 옮기고, 노출되어야 하는 상태를 반환
- 컴포저블 중첩 가능 > 컴포저블 함수에서 다른 컴포저블 함수 호출 가능
- 독립된 단위를 활용하여 복잡한 로직 구성

- 이벤트 리스너 분리
```js
// event.js
import { onMounted, onUnmounted } from 'vue'

export function useEventListener(target, event, callback) {
  onMounted(() => target.addEventListener(event, callback))
  onUnmounted(() => target.removeEventListener(event, callback))
}

// mouse.js
import { ref } from 'vue'
import { useEventListener } from './event'

export function useMouse() {
  const x = ref(0)
  const y = ref(0)

  useEventListener(window, 'mousemove', (event) => {
    x.value = event.pageX
    y.value = event.pageY
  })

  return { x, y }
}
```

- useMouse()를 호출하는 각 컴포넌트 인스턴스를 상태의 복사본을 생성하여 서로 공유하지 않음

## 3. 비동기 상태 예제
## 4. 관례와 모범 사례
## 5. 체계적인 코드를 위해 컴포저블로 추출하기
## 6. 옵션 API에서 컴포저블 적용
## 7. 다른 기술과의 비교
